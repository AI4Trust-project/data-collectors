metadata:
  name: news-checker
  labels:
    nuclio.io/project-name: news
  resourceVersion: "157236"
spec:
  handler: "main:handler"
  runtime: "python:3.10"
  env:
    - name: KAFKA_BROKER
      value: "my-cluster-kafka-bootstrap.kafka:9092"
  resources:
    requests:
      cpu: 25m
      memory: 1Mi
  triggers:
    http:
      class: ""
      kind: http
      name: http
      numWorkers: 1
      attributes:
        serviceType: ClusterIP
      maxWorkers: 1
    kafka:
      class: ""
      kind: kafka-cluster
      name: kafka
      numWorkers: 1
      workerTerminationTimeout: 10s
      explicitAckMode: disable
      attributes:
        brokers:
          - 'my-cluster-kafka-bootstrap.kafka:9092'
        consumerGroup: news_checker
        fetchDefault: 1048576
        heartbeatInterval: 3s
        initialOffset: latest
        maxWaitHandlerDuringRebalance: 5s
        rebalanceTimeout: 60s
        sasl:
          enable: false
          password: ""
          user: ""
        sessionTimeout: 10s
        topics:
          - news.fetched_articles
        workerAllocationMode: pool
      maxWorkers: 1
  version: -1
  alias: latest
  build:
    functionSourceCode: aW1wb3J0IGpzb24NCmltcG9ydCBvcw0KaW1wb3J0IHVybGxpYi5wYXJzZQ0KaW1wb3J0IHVybGxpYi5yZXF1ZXN0DQppbXBvcnQgdXJsbGliLnJvYm90cGFyc2VyDQoNCmZyb20ga2Fma2EgaW1wb3J0IEthZmthUHJvZHVjZXINCg0KDQpkZWYgaW5pdF9jb250ZXh0KGNvbnRleHQpOg0KICAgIHByb2R1Y2VyID0gS2Fma2FQcm9kdWNlcigNCiAgICAgICAgYm9vdHN0cmFwX3NlcnZlcnM9W29zLmVudmlyb24uZ2V0KCJLQUZLQV9CUk9LRVIiKV0sDQogICAgICAgIHZhbHVlX3NlcmlhbGl6ZXI9bGFtYmRhIHg6IGpzb24uZHVtcHMoeCkuZW5jb2RlKCJ1dGYtOCIpLA0KICAgICkNCg0KICAgIHNldGF0dHIoY29udGV4dCwgInByb2R1Y2VyIiwgcHJvZHVjZXIpDQoNCg0KZGVmIHJvYm90c19jaGVja2VyKHVybCwgdXNlcl9hZ2VudD0iKiIsIHRpbWVvdXQ9NSk6DQogICAgIiIiQ2hlY2sgaWYgYSBVUkwgaXMgYWxsb3dlZCB0byBiZSBzY3JhcGVkIGFjY29yZGluZyB0byB0aGUgc2l0ZSdzIHJvYm90cy50eHQgZmlsZS4iIiINCiAgICByb2JvdHNfdXJsID0gdXJsbGliLnBhcnNlLnVybGpvaW4odXJsLCAiL3JvYm90cy50eHQiKQ0KICAgIHJwID0gdXJsbGliLnJvYm90cGFyc2VyLlJvYm90RmlsZVBhcnNlcigpDQoNCiAgICB0cnk6DQogICAgICAgIHdpdGggdXJsbGliLnJlcXVlc3QudXJsb3Blbihyb2JvdHNfdXJsLCB0aW1lb3V0PXRpbWVvdXQpIGFzIHJlc3BvbnNlOg0KICAgICAgICAgICAgcm9ib3RzX3R4dCA9IHJlc3BvbnNlLnJlYWQoKS5kZWNvZGUoInV0Zi04IikNCiAgICAgICAgICAgIHJwLnBhcnNlKHJvYm90c190eHQuc3BsaXRsaW5lcygpKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJFcnJvciBjaGVja2luZyByb2JvdHMudHh0OiB7ZX0iKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIHJldHVybiBycC5jYW5fZmV0Y2godXNlcl9hZ2VudCwgdXJsKQ0KDQoNCmRlZiBjaGVja19hcnRpY2xlKGZldGNoZWRfYXJ0aWNsZSk6DQogICAgdXJsID0gZmV0Y2hlZF9hcnRpY2xlWyJ1cmwiXQ0KICAgIGNhbl9mZXRjaCA9IHJvYm90c19jaGVja2VyKHVybCkNCiAgICByZXR1cm4gY2FuX2ZldGNoDQoNCg0KZGVmIGhhbmRsZXIoY29udGV4dCwgZXZlbnQpOg0KDQogICAgcHJvZHVjZXIgPSBjb250ZXh0LnByb2R1Y2VyDQoNCiAgICBmZXRjaGVkX2FydGljbGUgPSBqc29uLmxvYWRzKGV2ZW50LmJvZHkuZGVjb2RlKCJ1dGYtOCIpKQ0KDQogICAgaWYgY2hlY2tfYXJ0aWNsZShmZXRjaGVkX2FydGljbGUpOg0KDQogICAgICAgIHByb2R1Y2VyLnNlbmQoIm5ld3MuYXBwcm92ZWRfYXJ0aWNsZXMiLCB2YWx1ZT1qc29uLmxvYWRzKGpzb24uZHVtcHMoZmV0Y2hlZF9hcnRpY2xlKSkpDQo=
    commands:
      - 'pip install kafka-python'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
    timestamp: 1733852754
  loggerSinks:
    - level: debug
  platform: {}
  securityContext: {}
  disableDefaultHTTPTrigger: false
  eventTimeout: ""

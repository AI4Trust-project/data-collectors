metadata:
  name: news-fetcher
  labels:
    nuclio.io/project-name: news
  resourceVersion: "156281"
spec:
  handler: "main:handler"
  runtime: "python:3.10"
  env:
    - name: KAFKA_BROKER
      value: "my-cluster-kafka-bootstrap.kafka:9092"
  resources:
    requests:
      cpu: 25m
      memory: 1Mi
  triggers:
    http:
      class: ""
      kind: http
      name: http
      numWorkers: 1
      attributes:
        serviceType: ClusterIP
      maxWorkers: 1
    kafka:
      class: ""
      kind: kafka-cluster
      name: kafka
      numWorkers: 1
      workerTerminationTimeout: 10s
      explicitAckMode: disable
      attributes:
        brokers:
          - 'my-cluster-kafka-bootstrap.kafka:9092'
        consumerGroup: news_fetcher
        fetchDefault: 1048576
        heartbeatInterval: 3s
        initialOffset: latest
        maxWaitHandlerDuringRebalance: 5s
        rebalanceTimeout: 60s
        sasl:
          enable: false
          password: ""
          user: ""
        sessionTimeout: 10s
        topics:
          - news.search_parameters
        workerAllocationMode: pool
      maxWorkers: 1
  version: -1
  alias: latest
  build:
    functionSourceCode: aW1wb3J0IGpzb24NCmltcG9ydCBvcw0KaW1wb3J0IHV1aWQNCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lem9uZQ0KDQpmcm9tIGdkZWx0ZG9jIGltcG9ydCBGaWx0ZXJzLCBHZGVsdERvYw0KZnJvbSBrYWZrYSBpbXBvcnQgS2Fma2FQcm9kdWNlcg0KDQoNCmRlZiBpbml0X2NvbnRleHQoY29udGV4dCk6DQogICAgcHJvZHVjZXIgPSBLYWZrYVByb2R1Y2VyKA0KICAgICAgICBib290c3RyYXBfc2VydmVycz1bb3MuZW52aXJvbi5nZXQoIktBRktBX0JST0tFUiIpXSwNCiAgICAgICAgdmFsdWVfc2VyaWFsaXplcj1sYW1iZGEgeDoganNvbi5kdW1wcyh4KS5lbmNvZGUoInV0Zi04IiksDQogICAgKQ0KDQogICAgc2V0YXR0cihjb250ZXh0LCAicHJvZHVjZXIiLCBwcm9kdWNlcikNCg0KDQpkZWYgZ2RlbHRfZmV0Y2hlcihzZWFyY2hfcGFyYW1ldGVycyk6DQogICAgIiIiRmV0Y2ggYXJ0aWNsZXMgZnJvbSBHREVMVCBiYXNlZCBvbiBzZWFyY2ggZmlsdGVycy4iIiINCiAgICBnZCA9IEdkZWx0RG9jKCkNCiAgICBmID0gRmlsdGVycygNCiAgICAgICAga2V5d29yZD1zZWFyY2hfcGFyYW1ldGVycy5nZXQoImtleXdvcmQiKSwNCiAgICAgICAgbnVtX3JlY29yZHM9c2VhcmNoX3BhcmFtZXRlcnMuZ2V0KCJudW1fcmVjb3JkcyIpLA0KICAgICAgICBzdGFydF9kYXRlPXNlYXJjaF9wYXJhbWV0ZXJzLmdldCgic3RhcnRfZGF0ZSIpLA0KICAgICAgICBlbmRfZGF0ZT1zZWFyY2hfcGFyYW1ldGVycy5nZXQoImVuZF9kYXRlIiksDQogICAgICAgIGNvdW50cnk9c2VhcmNoX3BhcmFtZXRlcnMuZ2V0KCJjb3VudHJ5IiksDQogICAgICAgIGRvbWFpbj1zZWFyY2hfcGFyYW1ldGVycy5nZXQoImRvbWFpbiIpLA0KICAgICAgICBkb21haW5fZXhhY3Q9c2VhcmNoX3BhcmFtZXRlcnMuZ2V0KCJkb21haW5fZXhhY3QiKSwNCiAgICAgICAgdGhlbWU9c2VhcmNoX3BhcmFtZXRlcnMuZ2V0KCJ0aGVtZSIpLA0KICAgICAgICBuZWFyPXNlYXJjaF9wYXJhbWV0ZXJzLmdldCgibmVhciIpLA0KICAgICAgICByZXBlYXQ9c2VhcmNoX3BhcmFtZXRlcnMuZ2V0KCJyZXBlYXQiKSwNCiAgICApDQogICAgdHJ5Og0KICAgICAgICBmZXRjaGVkX2FydGljbGVzID0gZ2QuYXJ0aWNsZV9zZWFyY2goZikNCiAgICAgICAgcmV0dXJuIGZldGNoZWRfYXJ0aWNsZXMNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiRXJyb3IgZmV0Y2hpbmcgYXJ0aWNsZXM6IHtlfSIpDQogICAgICAgIHJldHVybiBOb25lDQoNCg0KZGVmIGZldGNoX2FydGljbGVzKHNlYXJjaF9wYXJhbWV0ZXJzKToNCiAgICBmZXRjaGVkX2FydGljbGVzID0gZ2RlbHRfZmV0Y2hlcihzZWFyY2hfcGFyYW1ldGVycykNCiAgICByZXR1cm4gZmV0Y2hlZF9hcnRpY2xlcw0KDQoNCmRlZiBoYW5kbGVyKGNvbnRleHQsIGV2ZW50KToNCiAgICBwcm9kdWNlciA9IGNvbnRleHQucHJvZHVjZXINCg0KICAgIHRyeToNCg0KICAgICAgICBzZWFyY2hfcGFyYW1ldGVycyA9IGpzb24ubG9hZHMoZXZlbnQuYm9keS5kZWNvZGUoInV0Zi04IikpDQoNCiAgICAgICAgZmV0Y2hlZF9hcnRpY2xlcyA9IGZldGNoX2FydGljbGVzKHNlYXJjaF9wYXJhbWV0ZXJzKQ0KDQogICAgICAgIGlmIGZldGNoZWRfYXJ0aWNsZXMgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWFyY2hfcGFyYW1ldGVyc1sibl9yZXN1bHRzIl0gPSBsZW4oZmV0Y2hlZF9hcnRpY2xlcykNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNlYXJjaF9wYXJhbWV0ZXJzWyJuX3Jlc3VsdHMiXSA9IDANCg0KDQogICAgICAgIGZvciBfLCByb3cgaW4gZmV0Y2hlZF9hcnRpY2xlcy5pdGVycm93cygpOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGFydGljbGVfbWVzc2FnZSA9IHJvdy50b19kaWN0KCkNCiAgICAgICAgICAgICAgICBhcnRpY2xlX21lc3NhZ2VbInNlYXJjaF9kYXRlIl0gPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVktJW0tJWQiKQ0KDQogICAgICAgICAgICAgICAgIyBhZGQgYWRkaXRpb25hbCBpbmZvDQogICAgICAgICAgICAgICAgYXJ0aWNsZV9tZXNzYWdlWyJkYXRhX293bmVyIl0gPSBzZWFyY2hfcGFyYW1ldGVycy5nZXQoDQogICAgICAgICAgICAgICAgICAgICJkYXRhX293bmVyIiwgIkZCSy1ORVdTIg0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICBhcnRpY2xlX21lc3NhZ2VbImNyZWF0ZWRfYXQiXSA9IHNlYXJjaF9wYXJhbWV0ZXJzLmdldCgNCiAgICAgICAgICAgICAgICAgICAgImNyZWF0ZWRfYXQiLA0KICAgICAgICAgICAgICAgICAgICBkYXRldGltZS5ub3coKQ0KICAgICAgICAgICAgICAgICAgICAuYXN0aW1lem9uZSh0aW1lem9uZS51dGMpDQogICAgICAgICAgICAgICAgICAgIC5zdHJmdGltZSgiJVktJW0tJWRUJUg6JU06JVNaIiksDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGFydGljbGVfbWVzc2FnZVsic2VhcmNoX2lkIl0gPSBzZWFyY2hfcGFyYW1ldGVycy5nZXQoDQogICAgICAgICAgICAgICAgICAgICJpZCIsICJOb25lIg0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICBhcnRpY2xlX21lc3NhZ2VbImtleXdvcmRfaWQiXSA9IHNlYXJjaF9wYXJhbWV0ZXJzLmdldCgia2V5d29yZF9pZCIsICJOb25lIikNCiAgICAgICAgICAgICAgICBhcnRpY2xlX21lc3NhZ2VbImtleXdvcmQiXSA9IHNlYXJjaF9wYXJhbWV0ZXJzLmdldCgia2V5d29yZCIsICJOb25lIikNCiAgICAgICAgICAgICAgICBhcnRpY2xlX21lc3NhZ2VbImlkIl0gPSBzdHIodXVpZC51dWlkNCgpKQ0KDQogICAgICAgICAgICAgICAgYXJ0aWNsZV9qc29uID0ganNvbi5sb2Fkcyhqc29uLmR1bXBzKGFydGljbGVfbWVzc2FnZSkpDQoNCiAgICAgICAgICAgICAgICBwcm9kdWNlci5zZW5kKCJuZXdzLmZldGNoZWRfYXJ0aWNsZXMiLCB2YWx1ZT1hcnRpY2xlX2pzb24pDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgcHJpbnQoZSkNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIkVycm9yIGluIGZldGNoaW5nIHByb2Nlc3M6IHtlfSIpDQo=
    commands:
      - 'pip install kafka-python gdeltdoc'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
    timestamp: 1733852353
    image: ""
    noCache: false
    offline: false
    dependencies: []
  loggerSinks:
    - level: debug
  platform: {}
  securityContext: {}
  disableDefaultHTTPTrigger: false
  eventTimeout: ""
  waitReadinessTimeoutBeforeFailure: false

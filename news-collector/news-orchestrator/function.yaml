metadata:
  name: news-orchestrator
  labels:
    nuclio.io/project-name: news
  resourceVersion: "157958"
spec:
  handler: "main:handler"
  runtime: "python:3.10"
  env:
    - name: KAFKA_BROKER
      value: "my-cluster-kafka-bootstrap.kafka:9092"
    - name: DATABASE_NAME
      value: datalake
    - name: DATABASE_HOST
      value: postgres-minimal-cluster.default
    - name: DATABASE_USER
      value: 
    - name: DATABASE_PWD
      value: 
  resources:
    requests:
      cpu: 25m
      memory: 1Mi
  triggers:
    cron:
      class: ""
      kind: cron
      name: cron
      numWorkers: 1
      attributes:
        schedule: "0 0 1 * * *"
      maxWorkers: 1
    http:
      class: ""
      kind: http
      name: http
      numWorkers: 1
      attributes:
        serviceType: ClusterIP
      maxWorkers: 1
  version: -1
  alias: latest
  build:
    functionSourceCode: aW1wb3J0IGpzb24NCmltcG9ydCBvcw0KaW1wb3J0IHV1aWQNCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lZGVsdGEsIHRpbWV6b25lDQoNCmltcG9ydCBwc3ljb3BnMg0KZnJvbSBrYWZrYSBpbXBvcnQgS2Fma2FQcm9kdWNlcg0KDQoNCmRlZiBpbml0X2NvbnRleHQoY29udGV4dCk6DQogICAgcHJvZHVjZXIgPSBLYWZrYVByb2R1Y2VyKA0KICAgICAgICBib290c3RyYXBfc2VydmVycz1bb3MuZW52aXJvbi5nZXQoIktBRktBX0JST0tFUiIpXSwNCiAgICAgICAgdmFsdWVfc2VyaWFsaXplcj1sYW1iZGEgeDoganNvbi5kdW1wcyh4KS5lbmNvZGUoInV0Zi04IiksDQogICAgKQ0KDQogICAgZGJuYW1lID0gb3MuZW52aXJvbi5nZXQoIkRBVEFCQVNFX05BTUUiKQ0KICAgIHVzZXIgPSBvcy5lbnZpcm9uLmdldCgiREFUQUJBU0VfVVNFUiIpDQogICAgcGFzc3dvcmQgPSBvcy5lbnZpcm9uLmdldCgiREFUQUJBU0VfUFdEIikNCiAgICBob3N0ID0gb3MuZW52aXJvbi5nZXQoIkRBVEFCQVNFX0hPU1QiKQ0KDQogICAgY29ubiA9IHBzeWNvcGcyLmNvbm5lY3QoDQogICAgICAgIGRibmFtZT1kYm5hbWUsIHVzZXI9dXNlciwgcGFzc3dvcmQ9cGFzc3dvcmQsIGhvc3Q9aG9zdA0KICAgICkNCg0KICAgIHNldGF0dHIoY29udGV4dCwgInByb2R1Y2VyIiwgcHJvZHVjZXIpDQogICAgc2V0YXR0cihjb250ZXh0LCAiY29ubiIsIGNvbm4pDQoNCg0KZGVmIGdldF9rZXl3b3Jkcyhjb25uKToNCiAgICAiIiJHZXQga2V5d29yZHMgZnJvbSBkYXRhYmFzZSIiIg0KICAgIGN1ciA9IE5vbmUNCiAgICBkYXRhID0gW10NCg0KICAgIHRyeToNCg0KICAgICAgICBjdXIgPSBjb25uLmN1cnNvcigpDQoNCiAgICAgICAgcXVlcnkgPSAiU0VMRUNUIGtleXdvcmRfaWQsIGtleXdvcmQsIG51bV9yZWNvcmRzLCBjb3VudHJ5LCBkYXRhX293bmVyLCBkb21haW4sIGRvbWFpbl9leGFjdCwgdGhlbWUsIG5lYXIsIHJlcGVhdF8gRlJPTSBuZXdzLnNlYXJjaF9rZXl3b3JkcyINCg0KICAgICAgICBjdXIuZXhlY3V0ZShxdWVyeSkNCg0KICAgICAgICByb3cgPSBjdXIuZmV0Y2hhbGwoKQ0KDQogICAgICAgIGlmIHJvdzoNCiAgICAgICAgICAgIGZvciAoDQogICAgICAgICAgICAgICAga2V5d29yZF9pZCwNCiAgICAgICAgICAgICAgICBrZXl3b3JkLA0KICAgICAgICAgICAgICAgIG51bV9yZWNvcmRzLA0KICAgICAgICAgICAgICAgIGNvdW50cnksDQogICAgICAgICAgICAgICAgZGF0YV9vd25lciwNCiAgICAgICAgICAgICAgICBkb21haW4sDQogICAgICAgICAgICAgICAgZG9tYWluX2V4YWN0LA0KICAgICAgICAgICAgICAgIHRoZW1lLA0KICAgICAgICAgICAgICAgIG5lYXIsDQogICAgICAgICAgICAgICAgcmVwZWF0XywNCiAgICAgICAgICAgICkgaW4gcm93Og0KICAgICAgICAgICAgICAgIGNvbmZpZyA9IHsNCiAgICAgICAgICAgICAgICAgICAgImtleXdvcmRfaWQiOiBrZXl3b3JkX2lkLA0KICAgICAgICAgICAgICAgICAgICAia2V5d29yZCI6IGtleXdvcmQsDQogICAgICAgICAgICAgICAgICAgICJudW1fcmVjb3JkcyI6IG51bV9yZWNvcmRzLA0KICAgICAgICAgICAgICAgICAgICAiY291bnRyeSI6IGNvdW50cnksDQogICAgICAgICAgICAgICAgICAgICJkYXRhX293bmVyIjogZGF0YV9vd25lciwNCiAgICAgICAgICAgICAgICAgICAgImRvbWFpbiI6IGRvbWFpbiwNCiAgICAgICAgICAgICAgICAgICAgImRvbWFpbl9leGFjdCI6IGRvbWFpbl9leGFjdCwNCiAgICAgICAgICAgICAgICAgICAgInRoZW1lIjogdGhlbWUsDQogICAgICAgICAgICAgICAgICAgICJuZWFyIjogbmVhciwNCiAgICAgICAgICAgICAgICAgICAgInJlcGVhdCI6IHJlcGVhdF8sDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKGNvbmZpZykNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KCJFUlJPUiBGSU5EIEtFWVdPUkRTOiIpDQogICAgICAgIHByaW50KGUpDQogICAgZmluYWxseToNCiAgICAgICAgY3VyLmNsb3NlKCkNCg0KICAgIHJldHVybiBkYXRhDQoNCg0KZGVmIGhhbmRsZXIoY29udGV4dCwgZXZlbnQpOg0KICAgICIiIkdlbmVyYXRlIEthZmthIG1lc3NhZ2VzIGJhc2VkIG9uIHRoZSBjb25maWd1cmF0aW9uIGFuZCBzZW5kIHRoZW0uIiIiDQogICAgcHJvZHVjZXIgPSBjb250ZXh0LnByb2R1Y2VyDQogICAgY29uZmlncyA9IGdldF9rZXl3b3Jkcyhjb250ZXh0LmNvbm4pDQoNCiAgICBmb3IgY29uZmlnIGluIGNvbmZpZ3M6DQoNCiAgICAgICAga2V5d29yZF9pZCA9IGNvbmZpZy5nZXQoImtleXdvcmRfaWQiLCBOb25lKQ0KICAgICAgICBrZXl3b3JkID0gY29uZmlnLmdldCgia2V5d29yZCIsIE5vbmUpDQogICAgICAgIG51bV9yZWNvcmRzID0gY29uZmlnLmdldCgibnVtX3JlY29yZHMiLCAwKQ0KICAgICAgICBjb3VudHJ5ID0gY29uZmlnLmdldCgiY291bnRyeSIsIE5vbmUpDQogICAgICAgIGRhdGFfb3duZXIgPSBjb25maWcuZ2V0KCJkYXRhX293bmVyIiwgTm9uZSkNCiAgICAgICAgIyBvcHRpb25hbA0KICAgICAgICBkb21haW4gPSBjb25maWcuZ2V0KCJkb21haW4iLCBOb25lKQ0KICAgICAgICBkb21haW5fZXhhY3QgPSBjb25maWcuZ2V0KCJkb21haW5fZXhhY3QiLCBOb25lKQ0KICAgICAgICB0aGVtZSA9IGNvbmZpZy5nZXQoInRoZW1lIiwgTm9uZSkNCiAgICAgICAgbmVhciA9IGNvbmZpZy5nZXQoIm5lYXIiLCBOb25lKQ0KICAgICAgICByZXBlYXQgPSBjb25maWcuZ2V0KCJyZXBlYXQiLCBOb25lKQ0KDQogICAgICAgICMgc3RhcnRfZGF0ZSA9IGRhdGV0aW1lLm5vdygpIC0gdGltZWRlbHRhKGRheXM9MzY1ICogNSkgIyA1IHllYXJzIGFnbw0KDQogICAgICAgIGVuZF9kYXRlID0gZGF0ZXRpbWUubm93KCkNCiAgICAgICAgc3RhcnRfZGF0ZSA9IGRhdGV0aW1lLm5vdygpIC0gdGltZWRlbHRhKGRheXM9MikgICMgMiBkYXlzIGFnbw0KDQogICAgICAgIHN0YXJ0X2RhdGVfc3RyID0gc3RhcnRfZGF0ZS5zdHJmdGltZSgiJVktJW0tJWQiKQ0KICAgICAgICBlbmRfZGF0ZV9zdHIgPSBlbmRfZGF0ZS5zdHJmdGltZSgiJVktJW0tJWQiKQ0KDQogICAgICAgIG1lc3NhZ2UgPSB7DQogICAgICAgICAgICAiZGF0YV9vd25lciI6IGRhdGFfb3duZXIsDQogICAgICAgICAgICAiY3JlYXRlZF9hdCI6IGRhdGV0aW1lLm5vdygpDQogICAgICAgICAgICAuYXN0aW1lem9uZSh0aW1lem9uZS51dGMpDQogICAgICAgICAgICAuc3RyZnRpbWUoIiVZLSVtLSVkVCVIOiVNOiVTWiIpLA0KICAgICAgICAgICAgImlkIjogc3RyKHV1aWQudXVpZDQoKSksDQogICAgICAgICAgICAia2V5d29yZF9pZCI6IGtleXdvcmRfaWQsDQogICAgICAgICAgICAia2V5d29yZCI6IGtleXdvcmQsDQogICAgICAgICAgICAibnVtX3JlY29yZHMiOiBudW1fcmVjb3JkcywNCiAgICAgICAgICAgICJzdGFydF9kYXRlIjogc3RhcnRfZGF0ZV9zdHIsDQogICAgICAgICAgICAiZW5kX2RhdGUiOiBlbmRfZGF0ZV9zdHIsDQogICAgICAgICAgICAiY291bnRyeSI6IGNvdW50cnksDQogICAgICAgICAgICAiZG9tYWluIjogZG9tYWluLA0KICAgICAgICAgICAgImRvbWFpbl9leGFjdCI6IGRvbWFpbl9leGFjdCwNCiAgICAgICAgICAgICJ0aGVtZSI6IHRoZW1lLA0KICAgICAgICAgICAgIm5lYXIiOiBuZWFyLA0KICAgICAgICAgICAgInJlcGVhdCI6IHJlcGVhdCwNCiAgICAgICAgfQ0KDQogICAgICAgIHByb2R1Y2VyLnNlbmQoIm5ld3Muc2VhcmNoX3BhcmFtZXRlcnMiLCB2YWx1ZT1qc29uLmxvYWRzKGpzb24uZHVtcHMobWVzc2FnZSkpKQ0K
    commands:
      - 'pip install kafka-python psycopg2[binary]'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
    timestamp: 1733853068
  loggerSinks:
    - level: debug
  platform: {}
  securityContext: {}
  disableDefaultHTTPTrigger: false
  eventTimeout: ""

metadata:
  name: news-scraper
  labels:
    nuclio.io/project-name: news
  resourceVersion: "159842"
spec:
  handler: "main:handler"
  runtime: "python:3.10"
  env:
    - name: KAFKA_BROKER
      value: "my-cluster-kafka-bootstrap.kafka:9092"
  resources:
    requests:
      cpu: 25m
      memory: 1Mi
  triggers:
    http:
      class: ""
      kind: http
      name: http
      numWorkers: 1
      attributes:
        serviceType: ClusterIP
      maxWorkers: 1
    kafka:
      class: ""
      kind: kafka-cluster
      name: kafka
      numWorkers: 1
      workerTerminationTimeout: 10s
      explicitAckMode: disable
      attributes:
        brokers:
          - 'my-cluster-kafka-bootstrap.kafka:9092'
        consumerGroup: news_scraper
        fetchDefault: 1048576
        heartbeatInterval: 3s
        initialOffset: latest
        maxWaitHandlerDuringRebalance: 5s
        rebalanceTimeout: 60s
        sasl:
          enable: false
          password: ""
          user: ""
        sessionTimeout: 10s
        topics:
          - news.approved_articles
        workerAllocationMode: pool
      maxWorkers: 1
  version: -1
  alias: latest
  build:
    functionSourceCode: aW1wb3J0IGhhc2hsaWINCmltcG9ydCBqc29uDQppbXBvcnQgb3MNCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lem9uZQ0KZnJvbSBpbyBpbXBvcnQgQnl0ZXNJTw0KaW1wb3J0IHV1aWQNCg0KaW1wb3J0IG5sdGsNCmltcG9ydCByZXF1ZXN0cw0KZnJvbSBrYWZrYSBpbXBvcnQgS2Fma2FQcm9kdWNlcg0KZnJvbSBuZXdzcGFwZXIgaW1wb3J0IEFydGljbGUNCmZyb20gUElMIGltcG9ydCBJbWFnZQ0KDQoNCmRlZiBpbml0X2NvbnRleHQoY29udGV4dCk6DQoNCiAgICBwcm9kdWNlciA9IEthZmthUHJvZHVjZXIoDQogICAgICAgIGJvb3RzdHJhcF9zZXJ2ZXJzPVtvcy5lbnZpcm9uLmdldCgiS0FGS0FfQlJPS0VSIildLA0KICAgICAgICB2YWx1ZV9zZXJpYWxpemVyPWxhbWJkYSB4OiBqc29uLmR1bXBzKHgpLmVuY29kZSgidXRmLTgiKSwNCiAgICApDQoNCiAgICBzZXRhdHRyKGNvbnRleHQsICJwcm9kdWNlciIsIHByb2R1Y2VyKQ0KDQogICAgIyBubHRrLmRvd25sb2FkKCJwdW5rdF90YWIiKQ0KDQoNCmRlZiBoYXNoX2ltYWdlKGltYWdlX3VybCk6DQoNCiAgICAjIEZldGNoIHRoZSBpbWFnZSBmcm9tIHRoZSBpbWFnZSBVUkwNCiAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChpbWFnZV91cmwpDQogICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOg0KICAgICAgICAjIE9wZW4gdGhlIGltYWdlIHVzaW5nIFBJTA0KICAgICAgICBpbWcgPSBJbWFnZS5vcGVuKEJ5dGVzSU8ocmVzcG9uc2UuY29udGVudCkpDQoNCiAgICAgICAgIyBDb252ZXJ0IGltYWdlIHRvIGJ5dGVzDQogICAgICAgIGltZ19ieXRlX2FyciA9IEJ5dGVzSU8oKQ0KICAgICAgICBpbWcuc2F2ZShpbWdfYnl0ZV9hcnIsIGZvcm1hdD1pbWcuZm9ybWF0KQ0KICAgICAgICBpbWdfYnl0ZXMgPSBpbWdfYnl0ZV9hcnIuZ2V0dmFsdWUoKQ0KDQogICAgICAgICMgQ29tcHV0ZSBNRDUgaGFzaCBvZiB0aGUgaW1hZ2UgY29udGVudA0KICAgICAgICBpbWdfaGFzaCA9IGhhc2hsaWIubWQ1KGltZ19ieXRlcykuaGV4ZGlnZXN0KCkNCg0KICAgICAgICByZXR1cm4gaW1nX2hhc2gNCg0KDQpkZWYgbmV3c3BhcGVyM2tfc2NyYXBlcih1cmwpOg0KICAgICIiIlNjcmFwZSBhcnRpY2xlIGRhdGEgZnJvbSBhIGdpdmVuIFVSTCB1c2luZyB0aGUgbmV3c3BhcGVyM2sgbGlicmFyeS4iIiINCiAgICB1cmwgPSB1cmwuc3RyaXAoKQ0KICAgIGFydGljbGUgPSBBcnRpY2xlKHVybCkNCiAgICB0cnk6DQogICAgICAgIGFydGljbGUuZG93bmxvYWQoKQ0KICAgICAgICBhcnRpY2xlLnBhcnNlKCkNCiAgICAgICAgIyBhcnRpY2xlLm5scCgpDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAidGl0bGUiOiBhcnRpY2xlLnRpdGxlLA0KICAgICAgICAgICAgImF1dGhvcnMiOiBhcnRpY2xlLmF1dGhvcnMsDQogICAgICAgICAgICAicHVibGlzaF9kYXRlIjogKA0KICAgICAgICAgICAgICAgIGFydGljbGUucHVibGlzaF9kYXRlLmlzb2Zvcm1hdCgpIGlmIGFydGljbGUucHVibGlzaF9kYXRlIGVsc2UgTm9uZQ0KICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICJ0ZXh0IjogYXJ0aWNsZS50ZXh0LA0KICAgICAgICAgICAgInN1bW1hcnkiOiBhcnRpY2xlLnN1bW1hcnksDQogICAgICAgICAgICAia2V5d29yZHMiOiBhcnRpY2xlLmtleXdvcmRzLA0KICAgICAgICAgICAgInNvdXJjZV91cmwiOiBhcnRpY2xlLnNvdXJjZV91cmwsDQogICAgICAgICAgICAiaW1hZ2VfdXJsIjogYXJ0aWNsZS50b3BfaW1hZ2UsDQogICAgICAgIH0NCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiRXJyb3Igc2NyYXBpbmcgYXJ0aWNsZToge2V9IikNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KDQpkZWYgc2NyYXBlX2FydGljbGUoYXBwcm92ZWRfYXJ0aWNsZSk6DQogICAgdXJsID0gYXBwcm92ZWRfYXJ0aWNsZVsidXJsIl0NCiAgICBzY3JhcGVkX2FydGljbGVkID0gbmV3c3BhcGVyM2tfc2NyYXBlcih1cmwpDQogICAgcmV0dXJuIHNjcmFwZWRfYXJ0aWNsZWQNCg0KDQpkZWYgaGFuZGxlcihjb250ZXh0LCBldmVudCk6DQogICAgIyBJbml0aWFsaXplIEthZmthIFByb2R1Y2VyIGFuZCBDb25zdW1lcg0KICAgIHByb2R1Y2VyID0gY29udGV4dC5wcm9kdWNlcg0KDQogICAgYXBwcm92ZWRfYXJ0aWNsZSA9IGpzb24ubG9hZHMoZXZlbnQuYm9keS5kZWNvZGUoInV0Zi04IikpDQoNCiAgICBzY3JhcGVkX2FydGljbGUgPSBhcHByb3ZlZF9hcnRpY2xlIHwgc2NyYXBlX2FydGljbGUoYXBwcm92ZWRfYXJ0aWNsZSkNCg0KICAgIGlmIHNjcmFwZWRfYXJ0aWNsZToNCg0KICAgICAgICBpbWdfaGFzaCA9IGhhc2hfaW1hZ2Uoc2NyYXBlZF9hcnRpY2xlWyJpbWFnZV91cmwiXSkNCiAgICAgICAgc2NyYXBlZF9hcnRpY2xlWyJpbWFnZV9oYXNoIl0gPSAibWQ1OiIgKyBzdHIoaW1nX2hhc2gpDQoNCiAgICAgICAgIyBhZGQgYWRkaXRpb25hbCBpbmZvDQogICAgICAgIHNjcmFwZWRfYXJ0aWNsZVsiaWQiXSA9IHN0cih1dWlkLnV1aWQ0KCkpDQogICAgICAgIHNjcmFwZWRfYXJ0aWNsZVsiZmV0Y2hlZF9pZCJdID0gYXBwcm92ZWRfYXJ0aWNsZS5nZXQoImlkIiwgIk5vbmUiKQ0KICAgICAgICBzY3JhcGVkX2FydGljbGVbImRhdGFfb3duZXIiXSA9IGFwcHJvdmVkX2FydGljbGUuZ2V0KCJkYXRhX293bmVyIiwgIkZCSy1ORVdTIikNCiAgICAgICAgc2NyYXBlZF9hcnRpY2xlWyJjcmVhdGVkX2F0Il0gPSBhcHByb3ZlZF9hcnRpY2xlLmdldCgNCiAgICAgICAgICAgICJjcmVhdGVkX2F0IiwNCiAgICAgICAgICAgIGRhdGV0aW1lLm5vdygpLmFzdGltZXpvbmUodGltZXpvbmUudXRjKS5zdHJmdGltZSgiJVktJW0tJWRUJUg6JU06JVNaIiksDQogICAgICAgICkNCiAgICAgICAgc2NyYXBlZF9hcnRpY2xlWyJzZWFyY2hfaWQiXSA9IGFwcHJvdmVkX2FydGljbGUuZ2V0KCJzZWFyY2hfaWQiLCAiTm9uZSIpDQogICAgICAgIHNjcmFwZWRfYXJ0aWNsZVsia2V5d29yZF9pZCJdID0gYXBwcm92ZWRfYXJ0aWNsZS5nZXQoImtleXdvcmRfaWQiLCAiTm9uZSIpDQogICAgICAgIHNjcmFwZWRfYXJ0aWNsZVsia2V5d29yZCJdID0gYXBwcm92ZWRfYXJ0aWNsZS5nZXQoImtleXdvcmQiLCAiTm9uZSIpDQoNCiAgICAgICAgcHJvZHVjZXIuc2VuZCgibmV3cy5jb2xsZWN0ZWRfbmV3cyIsIHZhbHVlPWpzb24ubG9hZHMoanNvbi5kdW1wcyhzY3JhcGVkX2FydGljbGUpKSkNCg==
    commands:
      - 'pip install kafka-python nltk requests newspaper3k pillow lxml[html_clean] lxml_html_clean'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
    timestamp: 1733854038
  loggerSinks:
    - level: debug
  platform: {}
  securityContext: {}
  disableDefaultHTTPTrigger: false
  eventTimeout: ""
